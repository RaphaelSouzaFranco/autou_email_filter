<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AutoU - Classificador de Emails</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/styles/styles.css" rel="stylesheet">
</head>

<body class="dark-bg d-flex flex-column justify-content-center align-items-center">
    <h1 class="mb-4 text-center text-white">AutoU — Classificador de Emails</h1>

    <div class="glass-card w-100" style="max-width:500px;">
        <form id="emailForm" class="p-4">
            <div class="mb-3">
                <label for="email_text" class="form-label text-white">Cole o texto do e-mail</label>
                <textarea class="form-control" id="email_text" name="email_text" rows="6"
                    placeholder="Cole o conteúdo do e-mail aqui..."></textarea>
            </div>

            <div class="mb-3">
                <label for="email_file" class="form-label text-white">Ou faça upload (.txt, .pdf)</label>
                <input class="form-control" type="file" id="email_file" name="email_file" accept=".txt,.pdf">
            </div>

            <button type="submit" class="btn btn-primary w-100">Classificar e Gerar Resposta</button>
        </form>

        <div id="result" class="mt-3"></div>
    </div>

    <script>
        const BACKEND_URL = "https://autou-email-filter-5.onrender.com"; // URL do backend no Render

        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("emailForm");
            const textarea = document.getElementById("email_text");
            const resultDiv = document.getElementById("result");

            form.addEventListener("submit", async (e) => {
                e.preventDefault();

                const emailText = textarea.value.trim();
                if (!emailText) {
                    alert("Digite algum texto para o email!");
                    return;
                }

                resultDiv.innerHTML = "Processando...";

                try {
                    const response = await fetch(`${BACKEND_URL}/classify`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ email_text: emailText })
                    });

                    const data = await response.json();

                    if (data.error) {
                        resultDiv.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
                        return;
                    }

                    resultDiv.innerHTML = `
            <h5 class="text-white">Categoria: ${data.category}</h5>
            <h5 class="text-white mt-2">Resposta sugerida:</h5>
            <pre class="text-white" style="white-space: pre-wrap;">${data.reply}</pre>
          `;

                } catch (err) {
                    console.error(err);
                    resultDiv.innerHTML = `<div class="alert alert-danger">Erro ao processar o email.</div>`;
                }
            });
        });
    </script>
</body>

</html>